Frequently Asked Questions (FAQ)
========

This FAQ is designed to answer the most questions about AFWall+, please take your time to read it. 

Index
-----

* [Quick Guide](#quick-guide)
* [Frequently asked questions](#frequently-asked-questions)

Quick Guide
-----------

Start using AFWall+ the first time

1. Click on _Mode_ to switch between whitelist- (default enabled) and blacklist-mode.
2. Mark the applications that you want to block or allow (depending on the selected mode), for each interface.
3. Open the menu and enable the firewall (green shield means enabled). If the AFWall+ is already enabled, just select _Apply_ and it will submit your changes.
4. The rules will be saved and automatically and restored when you restart your phone. If not check the "data leak" option.
5. If you want to check all current iptables rules, select _Firewall Rules_ in the menu.

Widget(s)

To quickly enable or disable the firewall, add the AFWall+ widget to your home screen. 
There is no Widget description, the green shield means that the firewall is running, red means it's disabled. 
AFWall+ comes with three widgets, an settings widget, and two to toggle the firewall between enabled/disabled.

Firewall logs

If you want to see which applications have been blocked by AFWall+, open the menu and enable the Log.
AFWall+ will then log each application blocked. You can check the log by opening the menu and selecting _More_ -> _Show log_.

Password lock/unlock

You can set a password lock for AFWall+ by using the set _password_ menu option.
To remove the password protection, just reset it to blank (enter none).

Frequently asked questions
--------------------------

<a name="FAQ1"></a>
##### (1) What is iptables?

> Take a look [[here|IPtables]] for a detailed overview.

<a name="FAQ2"></a>
##### (2) How do I know if my phone supports iptables?

> Use the following command in ADB shell or in Terminal Emulator as root (`su`):

<code>iptables -L -t nat</code>

<a name="FAQ3"></a> 
##### (3) Packet processing in iptables

> All packets inspected by iptables pass through a sequence of built-in tables (queues) for processing. Each of these queues is dedicated to a particular type of packet activity and is controlled by an associated packet transformation/filtering chain.
* Forward (FORWARD) chain: Filters packets to servers protected by the firewall.
* Input (INPUT) chain: Filters packets destined for the firewall.
* Output (OUTPUT) chain: Filters packets originating from the firewall. 
* Prerouting (PREROUTING) chain: Address translation occurs before routing. Facilitates the transformation of the destination IP address to be compatible with the firewall's routing table.
* Postrouting (POSTROUTING) chain: Address translation occurs after routing. This implies that there was no need to modify the destination IP address of the packet as in pre-routing.
* Output (OUTPUT) via nat: Network address translation for packets generated by the firewall.

<a name="FAQ4"></a>
##### (4) Is a reboot required after edit/saving iptables?

> Changes to iptables take effect immediately when they are run. If you are making your changes in a script, you must make sure that script gets run in order for the changes to take affect. The rules are enforced as soon as the actual commands are sent to the kernel. You will need to figure out how to run the script or apply whatever conf changes you have saved to a file. A reboot actually clears all iptables rules. On first boot the tables will always be empty, you always have to set all the rules after booting. That's what the AFWall+ automatically does (make sure it's enabled).

<a name="FAQ5"></a>
##### (5) How long does it take for an iptables rule to apply?

> Iptables rules take effect immediately. Because your script is appending (-A) to the INPUT and OUTPUT chains, your rules are being added to the end of those chains. If you have other terminating rules that precede these rules, then they will take effect (and later rules will not).

<a name="FAQ6"></a>
##### (6) What is Active Rules?

> AFWall+ doesn't have control over iptables itself. Any root/system application with access to iptables can modify the rules. That's the reason, some time people gets app data leaks because some other process might have overwritten the OUTPUT chain to allow itself. To prevent this, AFWall+ will apply rules on every connectivity change. 

> Also for roaming/LAN, AFWall+ need to change the iptables rules in order to check Roaming status and LAN ip address.

<a name="FAQ7"></a>
##### (7) YouTube/Online Radio streaming is not working anymore. How can i fix this without disabling AFWall+?

> Please whitelist "Media Server" or remove it from your blacklist.

<a name="FAQ8"></a>
##### (8) What does the little "R" icon means?

> "R" indicates "Roaming". You can whitelist/blacklist applications when you are on a roaming network! It's disabled by default.

<a name="FAQ9"></a>
##### (9) My Logs (logcat) are not displaying anything or are always empty, why?

> AFWall+ logs are depend on dmesg (kernel logs). Either your kernel disabled dmesg or it's getting overwritten quickly. Please check if you kernel does have an option like "Android logger Control" or something like that an enable this service.

<a name="FAQ10"></a>
##### (10) Does AFWall+ support Android 4.3, 4.4 or higher?

> Yes, generally it should work with newer Android OS versions. 
* UID 0 (root) needs 53/udp open for DNS on Android 4.3. - Enable DNS from application list!
* UID 1000 (system) needs 123/udp open for NTP. - Enable NTP from application list!
* Android L need a little configuration change and a external Busybox app to get the rules apply.

<a name="FAQ11"></a>   
##### (11) Can I block incoming SMS?

> **No**, you [can't block it via AFWall+](https://github.com/ukanth/afwall/issues/111), iptables can't block low level traffic, some custom ROM's have such function already implemented in the dialer or sms app (blacklist). 

<a name="FAQ12"></a>
##### (12) Can I block IPv6 traffic?

> [Sure](https://github.com/ukanth/afwall/issues/108), please use AFWall+ 1.2.4 (or higher). Some kernels have an option to disable IPv6, make sure it's enabled (reboot required). "Enable IPv6 support" in AFWall+ options, because this is disabled by default.

<a name="FAQ13"></a>
##### (13) Is there Tasker/Locale support?

> Tasker/Locale apps working together with AFWall+ (1.0.4a or higher).

<a name="FAQ14"></a>
##### (14) UDP Port 53 is blocked if whitelisting mode is enabled, why?

> Please read [this](https://github.com/ukanth/afwall/issues/18). It's **disabled by default**.
Enable DNS from application list will unlock it.

<a name="FAQ15"></a>
##### (15) How can I show actually used iptables rules?

> Via  _iptables -L_ command in apps like [Android Terminal Emulator](https://play.google.com/store/apps/developer?id=Jack+Palevich). Most ROM's contain this. 

Or 

> Via <code>Firewall rules</code> from the AFWall+ preferences. 

<a name="FAQ16"></a>
##### (16) My Apps can bypass AFWall+ whitelist mode before the boot are complete

> Please read [this](https://github.com/ukanth/afwall/wiki/Apps-leak-user-privacy-data-during-boot).

> If you want to see what is connecting during the boot take a look at the _/proc/uid_stat/_ folder.

**Important note:** procfs is mounted at boot time, which means that every time your device is rebooted  there're 0 traffic values for all UIDs. You can list _/proc/uid_stat/_ dir right now to see which UIDs have been spending traffic since last reboot.

<a name="FAQ17"></a>
##### (17) How do I display all available network interfaces names using bash shell prompt?

> Open Android Terminal Emulator and type this:

<code>$ ip link show</code>

> Each network interface config is stored under the <code>/sys/class/net/</code> dir. If you list that dir on Android, you'll probably see [something like that](http://developer.android.com/reference/android/net/TrafficStats.html):

    $ ls sys/class/net
    lo
    dummy0
    ifb0
    ifb1
    rmnet0
    rmnet1
    rmnet2
    usb0
    sit0
    ip6tnl0
    gannet0
    tun
    eth0

<a name="FAQ18"></a>
##### (18) How can I purge the iptables rules?

> Open adb shell or Android Terminal Emulator and type this:

    su
    iptables -F
    iptables -X
    Reboot

> You can also do this via <code>Firewall Rules</code> option and click on the <code>flush rules</code> button. 

<a name="FAQ19"></a>
##### (19) AFWall+ does not show app xyz in my list, why?

> Only apps are listed that have **internet permissions** in the AndroidManifest.xml.

<a name="FAQ20"></a>
##### (20) AFWall+ does not work under CM 7.x - 11.x, how can i fix this?

> CM 7.x uses old version of iptables which has conflict with AFWall+ built-in iptables. As a workaround you can try to update your iptables to the latest version. But it should work without it. Contact developer/raise an issue on GitHub.
CM 11 users may need to change the busybox version from _bultin_ to _system busybox_. Of course you need to install it first.

<a name="FAQ21"></a>
##### (21) How to install AFWall+ as regular app?

<code> adb install afwall+.apk </code> (default install method)

> Or you may also copy and download the afwall+.apk file on your device and install it using any file explorers

<a name="FAQ22"></a>
##### (22) How to install AFWall+ as system app (**not recommend, only for test!**)

    adb remount
    adb push afwall+.apk /system/app (or /system/priv-app/ Android 4.3 or higher)

> You may an also move the .APK file to the _/system/app_ directory manually. Make sure you set the file permission properly _-rw-r--r--_. To uninstall, please remove afwall+.apk from _/system/app_ manually.

<a name="FAQ23"></a>
##### (23) Which Permissions are used?

>* _RECEIVE_BOOT_COMPLETED_: Autostart (Bootup) AFWall+ after the system finishes booting.
* _ACCESS_NETWORK_STATE_: Allows AFWall+ to access information about networks (iptables).
* _WRITE_EXTERNAL_STORAGE_: Allows AFWall+ to write to external storage for debug log and export iptables rules.
* _ACCESS_SUPERUSER_: Standard to support Superuser ([by Koushik](http://www.androidpolice.com/2013/02/25/koush-releases-free-open-source-superuser-app-with-support-for-multi-user-tablet-ui-x86arm-pin-and-effort-for-apps-to-declare-root-permission/)).
* _INTERNET_ : NetworkInterface.getNetworkInterfaces() needs android.permission.INTERNET. This is just being used to get the IPv4 and IPv6 addresses/subnets for each interface, so the LAN address ranges can be determined. Nothing is actually trying to access the network.
* _ACCESS_WIFI_STATE_ : Added to detect tether state.

<a name="FAQ24"></a>
##### (24) How can I disable the firewall temporarily?

> If you need to disable the firewall temporarily, you can flush all the rules using

<code>iptables -F</code>

Or via script

    echo "Stopping firewall and allowing everything..."
    iptables -F
    iptables -X
    iptables -t nat -F
    iptables -t nat -X
    iptables -t mangle -F
    iptables -t mangle -X
    iptables -P INPUT ACCEPT
    iptables -P FORWARD ACCEPT
    iptables -P OUTPUT ACCEPT
    exit 0

Or within the app itself.

<a name="FAQ25"></a>
##### (25) Can you help me with rooting my device?

> There are already enough guides to help you to root your device. Use your favorite search engine to find one.

<a name="FAQ26"></a>
##### (26) Does AFWall+ need a lot of battery/memory?

> Not really. Usually around _11 - 16 MB_ (non shared memory), dependent which configuration you use.

<a name="FAQ27"></a>
##### (27) How safe is AFWall+?

> Nothing is really safe, see the [limitations](https://github.com/ukanth/afwall#limitations) in the README.md for more details, but it's better to install a Firewall and control the incoming/outgoing packages than have nothing installed. If the app may crash sometimes than feel free to submit a error log report via eMail or on our GitHub Issue tracker, we are always motivated to fix problems and answer your questions.

<a name="FAQ28"></a>
##### (28) How can I make a logcat?

> Please take a deeper look at our [[Howto report a bug|HOWTO Report Bug]] page for additional details. 

<a name="FAQ29"></a>
##### (29) Will there be iOS or Windows Phone versions?

> No, because it's too difficult to implement something like AFWall+ on these OS's, because they are not open source and/or not supporting netfilters.

<a name="FAQ30"></a>
##### (30) Does AFWall+ work with SELinux (aka Fort Knox)?

> Should be without any bigger problem. For more info please look [here](http://www.selinuxproject.org/page/Main_Page) and [here](https://danwalsh.livejournal.com/28545.html).

<a name="FAQ31"></a>
##### (31) Can AFWall+ be detected by other applications?

> Yes, but it should be no security problem as long as the rules not get touched. 

<a name="FAQ32"></a>
##### (32) Do I need to have the Google Play Store installed for the donate version?

> Fast answer, no! There is no hidden license check integrated. 

<a name="FAQ33"></a>
##### (33) What happens if I make AFWall+ device administrator?

> This ensures that other applications cannot uninstall AFWall+ without your knowledge.

<a name="FAQ34"></a>
##### (34) Why the Kernel need an internet connection all the time?

> The kernel does not communicate directly, it only pass packet information (for the interfaces e.g. uid0) from some applications.
One problem with using policy routing based on fwmark with locally generated traffic (as is the case with Android) is that the mark must be set in the user process. It is because the routing decision is made before the fwmark can be set in any iptables rule, at least in vanilla kernels.

<a name="FAQ35"></a>
##### (35) Why was my issue closed?

> Things like ***It doesn't work* or *it crashes* is insufficient**. So, please describe the exact steps to reproduce the problem and always provide a logcat. More info always means that we can better help you. 

> It's also possible your issue is a duplicate, or is already fixed. Please watch the Changelog.md and TODO.md files carefully.

<a name="FAQ36"></a>
##### (36) Does AFWall+ support nftables yet?

> No, AFWall+ does not support [nftables](https://github.com/ukanth/afwall/issues/293) yet. There is currently no Android nftables firewall available on the whole www.

<a name="FAQ37"></a>
##### (37) Can I use XPrivacy, Lightning Wall, or any other Firewalls/Security apps together with AFWall+?

>* XPrivacy: should work fine, if you not restrict any AFWall+ or System related important features like 'IPC' or internet access. Be careful, if there is any problem you can watch what is blocked under the watch list in XPrivacy and try to remove it. 
* Lightning Wall: works fine together with AFWall+, because it does not interact with the existent iptables (leave iptables unchecked).
* Avast: please disable this firewall if it's turned on (unchecked by default).
* Android Tuner: Same as Avast, but the Firewall is disabled by default.
* [DonkeyGuard](http://www.repo.xposed.info/node/474): It can't control iptables, but Android's permission, so generally it work but don't restrict some important functions like _write_external_storage_, or AFWall+ log can't be created on your sdcard. 
* orWall: [orWall](https://orwall.org/) is not compatible with AFWall+. Please disable it and enable the _Transparent Proxy_ option in Orbot.
* Adblock Plus: Comes with there own iptables, but it should be no problem to use it together with AFWall+. If something went wrong and you like to report a bug, please disabled it first and try to reproduce the problem, if you manually created/enabled a proxy, shut it down first.

> Generally it's not necessary to use two firewalls together and it could be problematic if you don't know what you are doing, or did you use two knifes at the same time? :8ball:

<a name="FAQ38"></a>
##### (38) Will you integrate any HOSTS blocking option?

> No (see [#285](https://github.com/ukanth/afwall/issues/285) & [#223] (https://github.com/ukanth/afwall/issues/223)), AFWall+ is a firewall and not a all-in-one solution for all "security" related problems on Android. The goal is to control iptables with some gimmicks such custom scripts and this already implemented.
A big HOST file can also slow-down non high end smartphones, block some ads which some developer need to get money and can block some sites you may need. There are also other solutions to handle it, like [MoaAB](http://forum.xda-developers.com/showthread.php?t=1916098) or and Xposed module called [UnbelovedHosts] (http://repo.xposed.info/module/de.defim.apk.unbelovedhosts).

<a name="FAQ39"></a>
##### (39) Can I ask xyz that was not written down here?

> If you have any question, please leave a message in the [XDA AFWall+ forum thread](http://forum.xda-developers.com/showthread.php?t=1957231).

**If possible please do not ask questions using GitHub issues report!** Because GitHub issues are designed for bug reports and feature requests.

<a name="FAQ40"></a>
##### (40) Is there a BusyBox solution that doesn't need root?

> Yes, there is a solution coded by [Jared Burrows](https://plus.google.com/+JaredBurrows) but it doesn't provide all extra binaries, the most common used are included in this package. Visit [this page](http://www.burrowsapps.com/) for more information, or get it directly from [Google Play Store](https://play.google.com/store/apps/details?id=burrows.apps.busybox.paid&hl=en). We not recommend to use it!

<a name="FAQ41"></a>
##### (41) What is UID?

> The Android OS is based on Linux, so basically it's the same UID you have in a Unix-like OS. When installing an app/package, Android by default creates a [UID](http://developer.android.com/reference/android/os/Process.html#myUid%28%29) specifically for that package, so that it can have its private resources/storage space. When no packages are using anymore that UID (which could be shared), the UID is deleted.

> We can override this behavior with [android:sharedUserId](http://developer.android.com/guide/topics/manifest/manifest-element.html#uid), but it has some [drawbacks](http://stackoverflow.com/questions/5529846/androidprocess-and-process-name/5530160#5530160).

<a name="FAQ42"></a>
##### (42) How to change the DNS Settings on Android?

> On Android <4.4 we can use the command <code>getprop | grep dns</code> to know all the dns properties being used. This command requires BusyBox! 
> 'rmnet0’ is the interface name for the 3G connection. net.rmnet0.dns1 and net.rmnet0.dns2 are the properties to be changed to point to OpenDNS server (the settings are still present in CM/AOSP code). Since, these properties are changed after the connection is established, net.dns1 and net.dns2 also have to be changed.
Execute these commands as root user: setprop net.rmnet0.dns1 208.67.222.222. setprop net.rmnet0.dns2 208.67.220.220. setprop net.dns1 208.67.222.222. setprop net.dns2 208.67.220.220
> Remember, the settings will be applicable only for the current session! You will have to repeat it when you are re-connecting to the network.

> Android system chooses the DNS servers using the script located at _/system/etc/dhcpcd/dhcpcd-hooks/20-dns.conf_

<code>20-dns.conf</code>

To change the DNS servers, use the command “setprop <property name>”
<pre>
setprop net.dns1=208.67.222.222
setprop net.dns2=208.67.220.220
setprop net.eth0.dns1=208.67.222.222
setprop net.eth0.dns2=208.67.220.220 
setprop net.rmnet0.dns1=208.67.222.222
setprop net.rmnet0.dns2=208.67.220.220
setprop dhcp.tiwlan0.dns1=208.67.222.222
setprop dhcp.tiwlan0.dns2=208.67.220.220
setprop net.ppp0.dns1=208.67.222.222
setprop net.ppp0.dns2=208.67.220.220
setprop net.pdpbr1.dns1=208.67.222.222
setprop net.pdpbr1.dns2=208.67.220.220</pre>

Or as init.d script (won't reapply after connectivity change):
<pre>
#!/system/bin/sh
setprop dhcp.tiwlan0.dns1 208.67.222.222
setprop dhcp.tiwlan0.dns2 208.67.220.220
setprop net.ppp0.dns1 208.67.222.222
setprop net.ppp0.dns2 208.67.220.220
setprop net.dns1 208.67.222.222
setprop net.dns2 208.67.220.220
setprop net.rmnet0.dns1 208.67.222.222
setprop net.rmnet0.dns2 208.67.220.220
setprop net.pdpbr1.dns1 208.67.222.222
setprop net.pdpbr1.dns2 208.67.220.220</pre>

To check against it (on e.g. wlan) use
> tcpdump -ns0 -i wlan0 'port 53'

> [MyResolver](http://myresolver.info/) is a secure proof if it worked.

> If there is no setprop you can write the values before the _unset_dns_props()_ begins. Here is an [example 20-dns.conf file](https://gist.github.com/CHEF-KOCH/b054c88d8ba7975a1517). You can get the dns information by using the _getprop | grep dns_ command but this will only work for Android <4.3 devices. 

> The <code>getprop</code> or <code>setprop</code> method **does not work on Android versions (>4.4+) anymore**. Those values, when changed, get simply ignored by the _netd_ daemon. It's necessary to communicate directly to the daemon via the _/dev/socket/netd socket_. In Android it's now present a tool called _ndc_ which does exactly this job.

On 4.3 or 4.4 KitKat (#su):
> ndc resolver setifdns eth0 "" 208.67.222.222  208.67.220.220 192.168.1.1

> ndc resolver setdefaultif eth0

Or via AFWall+ custom script (init.d):
<pre>
$IPTABLES -t nat -D OUTPUT -p tcp --dport 53 -j DNAT --to-destination 208.67.222.222:53 || true
$IPTABLES -t nat -D OUTPUT -p udp --dport 53 -j DNAT --to-destination 208.67.222.222:53 || true</pre>

Or init.d:
<pre>
#!/system/bin/sh
IP6TABLES=/system/bin/ip6tables
IPTABLES=/system/bin/iptables if there are troubles apply them
# Maybe need to change $IPTABLES to iptables
$IPTABLES -t nat -I OUTPUT -p tcp --dport 53 -j DNAT --to-destination 208.67.222.222:53
$IPTABLES -t nat -I OUTPUT -p udp --dport 53 -j DNAT --to-destination 208.67.222.222:53</pre>

> Only _Google Puplic DNS_ supports IPv6 atm! So uncheck IPv6 in your kernel (if checked!) or disable via custom script.

> If you still like external apps, you should take a look at [DNS Forwarder](https://play.google.com/store/apps/details?id=com.evanhe.dnsforward) and [Override DNS](https://play.google.com/store/apps/details?id=net.mx17.overridedns)[tested, working on 4.4.4] which does more or less the same. That may solve some problems on Android 4.4/L but there is no guarantee, some ROM's may handle it different (still buggy/limitation).

<a name="FAQ43"></a>
##### (43) Will there a "Connection confirm dialog" (on-demand) feature implemented soon?

> It's already been asked [#269](https://github.com/ukanth/afwall/issues/269), there is currently no Android Firewall which include such feature yet. There is no on-demand firewall based on iptables available on Google Play Store/F-Droid. 

<a name="FAQ44"></a>
##### (44) Will you implement an Adblock function, and why are some Ads are still visible if I try to block them via iptables?

> First of all, AFWall+ is not [Adblock Plus](https://adblockplus.org/en/android-install). It's a firewall, which is not able (and never will be) to block all your visible ads and there are some good reason. Some app developer make money with in-app advertising (ie AdMob) and if we block this, no one is motivated to make some awesome apps anymore. If you really want to block such ads, you still can use [MinMinGuard](http://repo.xposed.info/module/tw.fatminmin.xposed.minminguard), but it's [general a bad idea to block all things](http://forum.xda-developers.com/showpost.php?p=49112940&postcount=1). For a quick overview over ad blocking please take a look at the [Wikipedia article](http://en.wikipedia.org/wiki/Ad_filtering).

> So I blocked my ads with ad server hostnames and IP addresses, why they are still visible?

> There are [some limitations](https://adblockplus.org/en/android-config#proxy) e.g. Adblock Plus for Android does not allow ads to be blocked on https/SSL encrypted websites [due Android limitations], some ad-servers use a proxy behind it, and it's generally hard to filter JavaScript generated content, currently there is no element hiding addon for Android. 
The easierst way is to block ads on Android seems to manipulate your DNS/Hosts file, for this you can use [this](http://hosts-file.net/?s=Download) or [this](forum.xda-developers.com/showthread.php?t=1916098&page=201) Hosts file which getting regular updates. There are [some alternative ways](https://sfxpt.wordpress.com/2011/02/21/the-best-ad-blocking-method/), but on newer Android systems they not seems to work anymore due some internal changes. 

> And why was Adblock Plus removed from Google Play Store?

> Read the full story [here](https://adblockplus.org/blog/adblock-plus-for-android-removed-from-google-play-store).

<a name="FAQ45"></a>
##### (45) I don't have the iptables binary on my phone, what can I do?
> If you have netfilter enabled in your kernel and not have the iptables binary you can use the AFWall+ inbuild iptables (make sure you enabled it in the options).

<a name="FAQ46"></a>
##### (46) Is there a good tool to collect Network Info?

> AFWall+ already collect some useful infos in the _Firewall Rules_ dialog but if you need a good and free tool to show some more infos, you can use [Network Info II](https://play.google.com/store/apps/details?id=aws.apps.networkInfoIi).